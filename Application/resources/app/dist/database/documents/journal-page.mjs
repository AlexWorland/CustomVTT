import ServerDocumentMixin from"../backend/server-document.mjs";import{BaseJournalEntryPage}from"../../../common/documents/module.mjs";import showdown from"showdown";import{cleanHTML}from"../validators.mjs";export default class JournalEntryPage extends(ServerDocumentMixin(BaseJournalEntryPage)){static#e=(()=>(Object.entries(CONST.SHOWDOWN_OPTIONS).forEach((([e,t])=>showdown.setOption(e,t))),new showdown.Converter))();async _preCreate(e,t,o){this.#t(this.text?.markdown)}async _preUpdate(e,t,o){this.#t(e.text?.markdown,e)}#t(e,t){const o=this.text.format===CONST.JOURNAL_ENTRY_PAGE_FORMATS.MARKDOWN&&e;if("text"!==this.type||!o)return;let r=JournalEntryPage.#e.makeHtml(e);r=cleanHTML(r),t&&(t["text.content"]=r),this.updateSource({"text.content":r})}}