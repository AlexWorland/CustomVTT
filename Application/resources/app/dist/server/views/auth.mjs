import sessions from"../../sessions.mjs";import*as util from"../../../common/utils/helpers.mjs";import{Module}from"../../packages/_module.mjs";import View from"./view.mjs";export default class AuthView extends View{route="/auth";socket="getAuthData";_template="auth";_methods=["get","post"];async handleGet(e,s){if(config.license.needsSignature)return s.redirect(`${e.baseUrl}/license`);if(global.game.world)return s.redirect(`${e.baseUrl}/join`);const t={bodyClass:"auth",messages:sessions.getMessages(e)},a=View._getStaticContent({setup:!0});t.scripts=a.scripts,t.styles=a.styles,s.render(this._template,t)}async handlePost(e,s){const{game:t}=global,a=sessions.authenticateAdmin(e,s),o=!t.world&&a.success;return s.redirect(e.baseUrl+util.getRoute(o?"setup":"auth"))}async handleSocket(e,s){return s({release:global.release,worlds:[],systems:[],modules:Module.getPackages({coreTranslation:!0}).map((e=>e.vend())),options:{language:global.config.options.language}})}}