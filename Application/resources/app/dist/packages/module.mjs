import{BaseModule}from"../../common/packages/module.mjs";import{isNewerVersion}from"../../common/utils/helpers.mjs";import ServerPackageMixin from"./package.mjs";export default class Module extends(ServerPackageMixin(BaseModule)){static#e;static getPackages({system:e,coreTranslation:t=!1,enforceCompatibility:i=!1}={}){return super.getPackages({enforceCompatibility:i}).reduce(((i,s)=>(t&&!s.providesCoreTranslation||e&&!s.isCompatibleWithSystem(e)||i.push(s),i)),[])}static getCoreTranslationOptions(){const e=this.getPackages({coreTranslation:!0}).reduce(((e,t)=>{let i=new Set;for(let s of t.languages){const a=e[s.lang]=e[s.lang]||{id:s.lang,label:"",modules:[]};a.label||(a.label=s.name),i.has(s.lang)||a.modules.push({id:t.id,label:t.title,path:s.path}),i.add(s.lang)}return e}),{en:{id:"en",label:"English",modules:[{id:"core",label:"Default",path:"lang/en.json"}]}});let t=[e.en];return e.en.modules=e.en.modules.slice(0,1),delete e.en,t.concat(Object.values(e))}static getCoreTranslationStyles(){if(!this.#e){const e=(config.options.language??"en.core").split(".")[1],t=this.getPackages({coreTranslation:!0}).find((t=>t.id===e));this.#e=t?.styles||[]}return this.#e}get providesCoreTranslation(){return this.coreTranslation&&this.languages.size}isCompatibleWithSystem(e){if(!this.relationships?.systems?.size)return!0;const t=this.relationships.systems.find((t=>t.id===e.id));return!!t&&((!t.compatibility?.minimum||!isNewerVersion(t.compatibility.minimum,e.version))&&(!t.compatibility?.maximum||!isNewerVersion(e.version,t.compatibility.maximum)))}}